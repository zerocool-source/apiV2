You are working in the API v2 backend Replit (Fastify + Prisma + Postgres) that deploys to Render.
Implement:
(A) Assignment lifecycle (cancel/status) with strict RBAC
(B) JWT stability: require stable JWT_SECRET and reasonable token TTL

A) Assignment lifecycle requirements

1) Prisma schema updates
- In Assignment model:
  - status enum should include: pending | in_progress | completed | canceled
  - Add canceledAt DateTime? (nullable)
  - Add canceledReason String? (nullable)
- Do NOT remove existing fields.
- If "status" already exists, extend it safely.
- Create a migration for these changes.

2) API behavior changes

2.1 PATCH /api/assignments/:id
- Auth required.
- Allowed updates by role:

TECH:
- Can update ONLY:
  - status (only: pending -> in_progress -> completed; tech cannot set canceled)
  - notes
  - completedAt (only when status becomes completed)
- Must NOT be able to change: propertyId, technicianId, scheduledDate, priority, etc.

SUPERVISOR:
- Can update ONLY assignments for technicians on their team (technician.technicianProfile.supervisorId == supervisor user id).
- Can update:
  - scheduledDate, priority, notes (optional)
  - status only for canceling: may set status=canceled
  - When canceling, set canceledAt=now and allow canceledReason.
- Must NOT be able to edit assignments outside their team.

ADMIN/REPAIR:
- Can update any assignment.
- Can cancel any assignment.

2.2 Cancel semantics
- Introduce cancel support via PATCH using:
  { "status": "canceled", "canceledReason": "..." }
- When status becomes canceled:
  - set canceledAt = new Date()
  - clear completedAt (optional but recommended if it could exist)
- Cancel should be idempotent: canceling an already-canceled assignment should not crash; just return the current record.

2.3 GET /api/assignments
- Default: exclude canceled assignments unless query param ?includeCanceled=true
- Respect existing supervisor/team filtering rules already implemented.
- Tech: sees only their assignments.
- Supervisor: sees only assignments for their team.
- Admin/repair: sees all.
- Add support for includeCanceled (and keep includeInactive logic if any exists elsewhere).

3) Tests and docs
- Add/update curl commands in replit.md:
  - Tech: PATCH status to in_progress then completed (success)
  - Tech: attempt to cancel (403)
  - Supervisor: cancel assignment for own tech (success)
  - Supervisor: cancel assignment for other supervisor tech (403)
  - GET /api/assignments default excludes canceled; includeCanceled=true includes them
- Ensure API responses return proper 401/403 and errors are consistent.

B) JWT stability requirements

1) JWT_SECRET
- Ensure server uses JWT_SECRET from env for signing/verifying JWTs.
- If JWT_SECRET is missing, fail fast at startup with a clear error message (do not generate a random secret).
- Add a note in replit.md describing how to set JWT_SECRET in Replit Secrets and Render env vars.

2) Token TTL
- Ensure token expiration is reasonable for dev/testing (e.g., 7 days) unless already set.
- Prefer env var JWT_EXPIRES_IN if present, else default to "7d".
- Make sure auth login returns a token with this TTL.

Deliverables:
- Prisma migration added and applied cleanly
- Code compiles, server runs
- RBAC works as specified
- replit.md updated with test commands and environment variable instructions
